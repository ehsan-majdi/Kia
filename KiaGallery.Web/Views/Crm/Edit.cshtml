
@{
    ViewBag.Title = "ویرایش مشتری ثبت شده";

}

<style>
    /*استایل مربوط به دکمه ثبت*/
    * {
        -webkit-transition-property: all;
        -webkit-transition-duration: .2s;
        -moz-transition-timing-function: cubic-bezier(100,50,21,6);
        -moz-transition-property: all;
        -moz-transition-duration: .2s;
        -moz-transition-timing-function: cubic-bezier(100,50,21,6);
    }

    .test {
        position: relative;
        display: inline-block;
        width: 166px;
        height: 45px;
        font-size: 15px;
        line-height: 45px;
        text-align: center;
        text-transform: uppercase;
        color: #000000;
        cursor: pointer;
        overflow: hidden;
    }

        .test svg {
            position: absolute;
            top: 0;
            left: 0;
        }

            .test svg rect {
                fill: none;
                stroke: #130c0c;
                stroke-width: 5;
                stroke-dasharray: 422, 0;
                transition: all 1300ms ease-in-out;
            }

        .test:hover svg rect {
            stroke-width: 5;
            stroke-dasharray: 10, 310;
            stroke-dashoffset: 33;
        }

        .test:hover {
            color: #fff;
            font-size: 18px;
            letter-spacing: 1px;
            font-weight: bold;
        }

    .btnTitle {
        background-color: #e6e6e6;
        border-color: #adadad;
        font-weight: 700;
    }

    .full-width {
        width: 100%;
    }

    .value-margin {
        margin: 7px 0;
    }

    .circle-1 {
        border-radius: 50%;
        background-color: white;
        width: 35px;
        height: 35px;
        position: absolute;
        margin: -17px 0 0 0;
    }

    .circle-2 {
        border-radius: 50%;
        background-color: white;
        width: 35px;
        height: 35px;
        position: absolute;
        margin: 30px 1105px 0 0;
    }

    .circle-3 {
        border-radius: 50%;
        background-color: white;
        width: 35px;
        height: 35px;
        position: absolute;
        margin: -15px 1105px 0 79px;
    }

    .circle-4 {
        border-radius: 50%;
        background-color: white;
        width: 35px;
        height: 35px;
        position: absolute;
        margin: 30px 0px 0 0;
    }

    .border-title {
        background-color: #1565c0;
        border-radius: 5px;
        opacity: 0.8;
        color: white;
        padding: 0;
        height: 50px;
        margin: 10px 0;
    }

        .border-title p {
            margin: 13px 48px;
        }

    .questionDescriptive {
        display: inline-block;
        background-color: cadetblue;
        padding: 10px 30px 10px;
        border-radius: 8px;
        margin: 20px auto;
    }

    /*استایل مربوط به چک باکس*/
    .checkbox {
        margin: auto;
        -webkit-user-select: none;
        user-select: none;
        cursor: pointer;
        display: inline-block;
    }

        .checkbox span {
            display: inline-block;
            vertical-align: middle;
            transform: translate3d(0, 0, 0);
            -webkit-transform: translate3d(0, 0, 0);
            -moz-transform: translate3d(0, 0, 0);
            -ms-transform: translate3d(0, 0, 0);
            -o-transform: translate3d(0, 0, 0);
        }

            .checkbox span:first-child {
                position: relative;
                width: 18px;
                height: 18px;
                border-radius: 3px;
                transform: scale(1);
                vertical-align: middle;
                border: 1px solid #9098A9;
                transition: all 0.2s ease;
                -webkit-transform: scale(1);
                -moz-transform: scale(1);
                -ms-transform: scale(1);
                -o-transform: scale(1);
            }

                .checkbox span:first-child svg {
                    position: absolute;
                    top: 3px;
                    left: 2px;
                    fill: none;
                    stroke: #FFFFFF;
                    stroke-width: 2;
                    stroke-linecap: round;
                    stroke-linejoin: round;
                    stroke-dasharray: 16px;
                    stroke-dashoffset: 16px;
                    transition: all 0.3s ease;
                    transition-delay: 0.1s;
                    transform: translate3d(0, 0, 0);
                    -webkit-transform: translate3d(0, 0, 0);
                    -moz-transform: translate3d(0, 0, 0);
                    -ms-transform: translate3d(0, 0, 0);
                    -o-transform: translate3d(0, 0, 0);
                }

                .checkbox span:first-child:before {
                    content: "";
                    width: 100%;
                    height: 100%;
                    background: #506EEC;
                    display: block;
                    transform: scale(0);
                    opacity: 1;
                    border-radius: 50%;
                    -webkit-transform: scale(0);
                    -moz-transform: scale(0);
                    -ms-transform: scale(0);
                    -o-transform: scale(0);
                }

            .checkbox span:last-child {
                padding-left: 8px;
            }

        .checkbox:hover span:first-child {
            border-color: #506EEC;
        }

    .inputcheck:checked + .checkbox span:first-child {
        background: #506EEC;
        border-color: #506EEC;
        animation: wave 0.4s ease;
    }

        .inputcheck:checked + .checkbox span:first-child svg {
            stroke-dashoffset: 0;
        }

        .inputcheck:checked + .checkbox span:first-child:before {
            transform: scale(3.5);
            opacity: 0;
            transition: all 0.6s ease;
        }

    @@keyframes wave {
        50% {
            transform: scale(0.9);
        }
    }

    #btnSave {
        padding: 0 30px !important;
    }

    .active {
        background-color: #bdbdbd;
    }

    #question-title {
        background-color: #2962ff;
        padding: 4px 5px;
        margin-top: 0;
        color: white;
    }

    .width {
        width: 120px;
        height: 120px;
        border-radius: 50%;
    }

        .width:hover {
            background-color: #fdd835;
            transition: all 800ms ease;
            border: 5px solid #adadad;
        }
</style>
<div class="container">
    <form>
        <div id="form">
            <input id="hiddenId" type="hidden" name="id" value="@ViewBag.Id" />
            <input id="buyTypeSubset" type="hidden" name="buyTypeSubset" />
            <input id="buyTypeOnline" type="hidden" name="buyTypeOnline" />
            <div class="col-md-3">
                <div class="form-group">
                    <label for="txtName">نام کامل مشتری</label>
                    <input id="txtName" class="form-control" placeholder="نام و نام خانوادگی" maxlength="50" name="fullName" />
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-group">
                    <label for="txtDate">تاریخ</label>
                    <input id=txtDate class="form-control date" placeholder="تاریخ" name="date" />
                </div>
            </div>
            <div class="form-group col-lg-3">
                <label for="txtPhoneNumber">شماره همراه</label>
                <input id="txtPhoneNumber" class="form-control" placeholder="شماره همراه" name="phoneNumber" />
            </div>
            <div class="form-group col-lg-2">
                <label for="txtFactor">شماره فاکتور</label>
                <input id="txtFactor" class="form-control" placeholder="شماره همراه" name="factorNumber" />
            </div>
            @*<div class="form-group col-md-3">
                    <label for="cmbBuyType">نوع خرید</label>
                    <select id="cmbBuyType" class="form-control" name="buyType">
                        <option value="true">آنلاین</option>
                        <option value="false">تلفنی</option>
                    </select>
                </div>*@
            <div class="form-group col-md-1">
                <label for="cmbScore">امتیاز</label>
                <select id="cmbScore" class="form-control" name="score">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                </select>
            </div>

        </div>


        <div class="col-md-12">
            <div id="btnSave" class="test">
                <svg>
                    <rect x="0" y="0" fill="none" width="166" height="45" />
                </svg>
                <span><i class="fa fa-check"></i></span>
                ثبت

            </div>
        </div>

    </form>

</div>
<br />
<br />

<div id="content">

</div>

@section Scripts {
    <script type="text/javascript">
        var id = @(ViewBag.Id != null ? ViewBag.Id : 0);

        $(document).ready(function () {
            $(".date").pDatepicker({
                format: 'YYYY/MM/DD',
                autoClose: true,
            });

            $("#btnSave").on("click", function (event) {
                event.preventDefault();

                var entity = getEntity("#form");

                entity.answerList = [];
                $(".detail-entity").each(function (index, element) {
                    var detailEntity = getEntity(element);
                    if (detailEntity.crmQuestionType == 1 ) {
                        detailEntity.crmQuestionValueId = detailEntity.crmQuestionValueId.join("-");
                    }
                    entity.answerList.push(detailEntity);
                });
                $(".single-entity").each(function (index, element) {
                    var crmQuestionId = $(element).find(".crmQuestionId").val();
                    var crmQuestionValueId = $(element).find("input[type=radio]:checked").val();
                    var detailEntity = { crmQuestionId: crmQuestionId, crmQuestionValueId: crmQuestionValueId };
                    entity.answerList.push(detailEntity);
                })
                
                if (checkForm("#form")) {
                    loader(true);
                    $.post("/crm/saveCustomer", entity, function (response) {
                        loader(false);
                        if (response.status == 200) {
                            callbackAlert(response.message, function () {
                                document.location = "/crm/index/";
                            })
                        }
                        else {
                            alert(response.message);
                        }
                    });
                }
            });
            getQuestionList();
        });

        function getQuestionList() {
            loader(true);
            $.get("/crm/GetQuestionListEditByUser", { id: $("#hiddenId").val()},function (response) {
                if (response.status == 200) {
                    var data = response.data;
                    var template = $.templates("#template");
                    var htmlOutput = template.render(data);
                    $("#content").html(htmlOutput);
                    load();
                }
                else {
                    alert(response.message);
                }
                loader(false);
            });
        }

        function load() {
            if (id > 0) {
                loader(true);
                $.get("/crm/loadCustomer/" + id, function (response) {
                    if (response.status == 200) {
                        var data = response.data;
                        setEntity(data, "#form");
                        var list = response.data.answerList;
                        if (list.length > 0) {
                            $('input[type="radio"]').prop("checked", false);
                            $('input[type="checkbox"]').prop("checked", false);
                            $('input[type="text"]').val("");
                            for (var i = 0; i < list.length; i++) {
                                var item = list[i];
                                var element = $(".detail-entity[data-question-id=" + item.crmQuestionId + "]");

                                if (item.crmQuestionType == 0) {
                                    var checked = $(".default-YesNo[data-question-id=" + item.crmQuestionId + "]");
                                    if (item.yesNoAnswer == true) {
                                        $(checked).find("input[name=yesNoAnswer][value=true]").prop("checked", true);
                                    }
                                    else {
                                        $(checked).find("input[name=yesNoAnswer][value=false]").prop("checked", true);
                                    }
                                }
                                if (item.crmQuestionType == 1 && item.crmQuestionValueId != null)
                                {
                                    item.crmQuestionValueId = item.crmQuestionValueId.split("-");
                                    $("input[type=checkbox]").val(item.crmQuestionValueId);
                                }
                                if (item.crmQuestionType == 2) {
                                    $("input[data-value-id=" + item.crmQuestionValueId + "]").prop("checked", true);
                                }
                                if (item.crmQuestionType == 3) {
                                    $(element).find("textarea").val(item.descriptiveAnswer);
                                }
                            }
                        }
                    }
                    else {
                        alert(response.message);
                    }
                    loader(false);
                });
            }
        }
    </script>
    <script id="template" type="text/x-jsrender">
        <div class="container">
            {{for list}}
            {{if crmQuestionType != 2}}
            <div class="detail-entity" data-question-id="{{:id}}">
                <input type="hidden" name="crmQuestionId" value="{{:id}}" />
                <input type="hidden" name="crmQuestionType" value="{{:crmQuestionType}}" />
                <input type="hidden" name="buyType" value="{{:buyType}}" />
                <div class="col-md-12 border-title">
                    <div class="circle-1"></div>
                    <div class="circle-2"></div>
                    <div class="circle-3"></div>
                    <div class="circle-4"></div>
                    <p class="">{{:title}}</p>
                </div>
                {{if crmQuestionType == 0}}
                <div class="default-YesNo" data-question-id="{{:id}}">

                    <label>
                        <input class="value" type="radio" name="yesNoAnswer" value="true" style="margin:20px 0" />
                        بله
                        <input class="value" type="radio" name="yesNoAnswer" value="false" />
                        خیر
                    </label>
                    &nbsp;&nbsp;&nbsp;&nbsp;
                    <label>

                    </label>
                </div>
                {{/if}}

                {{if crmQuestionType==1}}
                {{if crmQuestionValueViewModelList.length <= 4}}
                {{for crmQuestionValueViewModelList}}
                <form>
                    <div class="radioButton-group">
                        <div class="col-md-3" style="margin:17px 0">
                            <input id="checkBox{{:id}}" type="checkbox" class="inputcheck v-middle " value="{{:id}}" {{if defaultSelected}} checked{{/if}} name="crmQuestionValueId" style="display:none;" />
                            <label class="checkbox inputcheck v-middle form-element" for="checkBox{{:id}}">
                                <span>
                                    <svg width="12px" height="10px" viewBox="0 0 12 10">
                                        <polyline points="1.5 6 4.5 9 10.5 1"></polyline>
                                    </svg>
                                </span>
                                <span>{{:value}}</span>
                            </label>
                        </div>
                    </div>
                </form>

                {{/for}}
                {{/if}}
                {{if crmQuestionValueViewModelList.length>4}}
                {{for crmQuestionValueViewModelList}}
                <br />
                <form>
                    <div class="radioButton-group">
                        <div class="col-md-12" style="margin:5px 0">
                            <input id="checkBox1{{:id}}" type="checkbox" class="form-element inputcheck v-middle " value="{{:id}}" {{if defaultSelected}} checked{{/if}} name="crmQuestionValueId" style="display:none;" />
                            <label class="checkbox inputcheck form-element v-middle" for="checkBox1{{:id}}">
                                <span>
                                    <svg width="12px" height="10px" viewBox="0 0 12 10">
                                        <polyline points="1.5 6 4.5 9 10.5 1"></polyline>
                                    </svg>
                                </span>
                                <span>{{:value}}</span>
                            </label>
                        </div>
                    </div>
                </form>

                {{/for}}
                {{/if}}
                {{/if}}

                {{if crmQuestionType==3}}
                <div class=questionDescriptive>
                    <br />
                    <p class="">شرح سوال</p>
                    <span style="font-size:20px">:</span>
                    <label>{{:defaultDescriptive}}</label>
                    <br />
                    <br />
                </div>
                <textarea  type="text" class="form-control  empty-val v-middle " placeholder="توضیحات" cols="10" rows="3" name="descriptiveAnswer" style="resize:none;">{{:description}}</textarea>
                {{/if}}
            </div>
            {{/if}}
            {{if crmQuestionType == 2}}
            <div class="single-entity">
                <div class="col-md-12 border-title">
                    <div class="circle-1"></div>
                    <div class="circle-2"></div>
                    <div class="circle-3"></div>
                    <div class="circle-4"></div>
                    <p class="">{{:title}}</p>
                </div>
                <input type="hidden" class="crmQuestionId" value="{{:id}}" />
                {{for crmQuestionValueViewModelList}}
                <div class="value-margin ">
                    <input type="radio" class="form-element v-middle " value="{{:id}}" {{if defaultSelected}} checked{{/if}} name="crmQuestionValueId{{:crmQuestionId}}" data-value-id="{{:id}}" />
                    <label>{{:value}}</label>
                </div>
                {{/for}}
            </div>
            {{/if}}
            {{/for}}
        </div>
    </script>
}
